# 操作系统实验 四报告

## 一 、实验内容：

​	1、在内存中开辟一个虚拟磁盘空间作为文件存储分区，在其中实现一个简单的基于多级目录的单用户单任务系统中的文件系统。在退出该文件系统的使用时，应将该虚拟文件系统以一个windows文件的方式保存到磁盘上，以便下次可以再将它恢复到内存的虚拟磁盘

2、空闲磁盘空间的管理选用位示图来管理文件存储空间，采用显示链接方式，将位示图合并到FAT表内

3、 文件目录结构采用多级目录结构。为了简单起见，可以不使用索引结点，其中的每个目录项应包含文件名、物理地址、长度等信息，还可以通过目录项实现对文件的读和写的保护。

## 二、实验思路

![image-20210612230331477](/home/david/.config/Typora/typora-user-images/image-20210612230331477.png)





## 三、遇到的问题

#### 1、i节点大小设置错误

​	初步设计的文件系统中采用的i节点大小并未设置预留空间，并且直接根据sizeof(inode)的大小（于测试文件中测试了初期设计的i节点大小）安排了整个文件系统的物理块区域排布，但代码编写阶段发现由于i节点保存的时间数据实际上应该由教材中的unsigned short改为int，这是由于由时间函数正常获取的系统时间数值较大，需要int类型才能保存，而由于时间限制又没有编写相应的时间裁切，只得直接改变i节点内部数据结构，导致i节点内的数据结构必须更改，且必须扩充i节点容量，此时发现由于i节点在整个文件系统的虚拟磁盘空间中保存的位置较为靠前（为整个文件系统的第四个部分），导致之后的结构受到了较为严重的影响

#### 2、忽略函数内部相互调用关系

​	与小组在分配编写不同模块任务时，未仔细考虑到函数有相互调用的关系，最为具有代表性的举例，是my_cd函数与my_open、my_close函数的先后次序与内部联系，在中期小组内讨论后放弃了现有的完成的函数，在通读了所有功能的要求后绘制了相应的模块间关系图，而后再依照该图的拓扑结构进行函数功能的编写。
